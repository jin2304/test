<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram 스타일 게시물</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 광고 분석 버튼 스타일 */
        #popup-button {
            display: block; /* 블록 요소 */
            margin-top: 20px; /* 위 요소와의 간격 증가 */
            width: auto; /* 내용에 맞게 버튼 크기 조정 */
            padding: 5px 10px; /* 버튼 내부 패딩 */
            font-size: 0.875rem; /* 텍스트 크기 */
            text-align: center; /* 텍스트 중앙 정렬 */
            background-color: #007bff; /* 버튼 배경색 */
            color: white; /* 텍스트 색상 */
            border-radius: 5px; /* 둥근 모서리 */
            cursor: pointer; /* 포인터 커서 */
            transition: background-color 0.3s; /* 호버 효과 */
        }

        #popup-button:hover {
            background-color: #0056b3; /* 호버 시 배경색 */
        }

        /* 북마크와 좋아요 섹션 전체 간격 조정 */
        .p-4 {
            padding-top: 30px; /* 상단 패딩 추가 */
        }

        /* 반응형 스타일 */
        @media (max-width: 768px) {
            #popup-button {
                font-size: 0.75rem; /* 작은 화면에서 텍스트 크기 축소 */
                padding: 4px 8px; /* 버튼 크기 축소 */
            }
        }

        /*!* #와 @로 시작하는 단어를 파란색으로 표시하는 클래스 *!*/
        /*.highlight {*/
        /*    color: #568bbf; !* 파란색 텍스트 *!*/
        /*    font-weight: bold; !* 강조 효과 *!*/
        /*    cursor: pointer; !* 포인터 효과 (선택 사항) *!*/
        /*}*/
    </style>
</head>
<body class="bg-gray-100 flex flex-col h-screen">
    <!-- 네비게이션 바 -->
    <nav class="bg-white border-b border-gray-300 fixed top-0 left-0 w-full z-10">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="text-xl font-bold">Instagram</div>
                <div class="flex space-x-4">
                    <button class="p-1">
                        <svg class="w-6 h-6 text-gray-600 hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 메인 게시물 -->
    <main class="flex flex-row bg-white border border-gray-300 rounded-lg shadow-lg overflow-hidden w-full max-w-6xl h-[700px] mt-24 mx-auto">
        <!-- 이미지 섹션 -->
        <div class="flex-1 bg-black relative">
            <img id="post-image" src="/images/1.jpg" alt="Post Image" class="w-full h-full object-cover">
            <button id="prev-post" class="absolute top-1/2 left-3 transform -translate-y-1/2 bg-black/60 text-white rounded-full w-9 h-9 flex items-center justify-center z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <button id="next-post" class="absolute top-1/2 right-3 transform -translate-y-1/2 bg-black/60 text-white rounded-full w-9 h-9 flex items-center justify-center z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
        </div>

        <!-- 텍스트 섹션 -->
        <div class="flex-1 flex flex-col">
            <!-- 사용자 프로필 -->
            <div class="flex items-center justify-between p-4 border-b border-gray-300">
                <div class="flex items-center">
                    <img src="https://via.placeholder.com/40" alt="User Avatar" class="w-10 h-10 rounded-full border border-gray-300">
                    <div class="ml-3">
                        <div class="text-sm font-semibold text-gray-800">AD_cleaner</div>
                        <div class="text-xs text-gray-500">팔로워 10K명</div>
                    </div>
                </div>
                <!-- 광고성 확률 표시 복구 -->
                <div class="text-red-600 font-bold text-sm" id="ad-probability">광고성 확률: 0%</div>
            </div>

            <!-- 본문 -->
            <div class="flex-1 p-4 overflow-y-auto text-sm text-gray-800">
                <div id="post-text">
                    <p>게시물 텍스트가 여기에 표시됩니다.</p>
                </div>
            </div>

            <!-- 좋아요, 댓글, 공유, 북마크, 광고 분석 -->
            <div class="p-4 border-t border-gray-300">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex space-x-4">
                        <!-- 좋아요 -->
                        <button>
                            <svg class="w-6 h-6 text-gray-600 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                        </button>
                        <!-- 댓글 -->
                        <button>
                            <svg class="w-6 h-6 text-gray-600 hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                        </button>
                        <!-- 공유 -->
                        <button>
                            <svg class="w-6 h-6 text-gray-600 hover:text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- 북마크 -->
                    <button>
                        <svg class="w-6 h-6 text-gray-600 hover:text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                    </button>
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex flex-col items-start">
                        <p class="font-semibold">좋아요 1,234개</p>
                        <p class="text-xs text-gray-500 mt-1">11월 3일</p>
                    </div>
                    <!-- 광고 분석 버튼 -->
                    <button id="popup-button" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 px-3.5 text-sm rounded">
                        광고 분석
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 팝업 모달 -->
    <div id="modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden z-20">
        <div id="modal-content" class="bg-white rounded-lg shadow-lg p-8 relative resize overflow-auto w-[80%] max-w-[800px] max-h-[90vh]">
            <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl">
                &times;
            </button>
            <h3 class="text-2xl font-bold mb-6">광고성 수치 분석</h3>
            <textarea id="user-input" class="resize w-full h-[200px] border border-gray-300 rounded-lg p-3 text-sm mb-6" placeholder="분석할 내용을 입력하세요..."></textarea>
            <button id="analyze-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded">
                분석 실행
            </button>
            <div id="result-section" class="mt-8 hidden">
                <p class="text-lg font-bold text-red-600 mb-4" id="ad-score">광고성 확률: 0%</p>
                <div class="overflow-y-auto max-h-48 border-t pt-4">
                    <h4 class="font-bold text-gray-600 mb-2">중요 키워드:</h4>
                    <ul id="keyword-list" class="list-disc pl-6 text-base text-gray-800"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 데이터 처리 스크립트 -->
    <script>
        // 서버에서 가져온 게시물 데이터(JSON)
        const postsData = {{ predictions | tojson }};
        let currentPostIndex = 0;

        // 게시물 표시 함수
        function displayPost() {
            if (currentPostIndex < postsData.length) {
                const post = postsData[currentPostIndex];

                // 이미지 업데이트 (1.jpg ~ 10.jpg)
                const imgElement = document.getElementById("post-image");
                imgElement.src = `/images/${currentPostIndex + 1}.jpg`;

                // 게시물 텍스트 표시
                document.getElementById("post-text").innerHTML = `<p>${post["원본 텍스트"]}</p>`;

                // 광고성 확률 추출 및 표시
                const probabilityText = post["확률"];
                if (probabilityText) {
                    const adProbabilityMatch = probabilityText.match(/광고성 ([\d.]+)%/);
                    if (adProbabilityMatch) {
                        const adProbability = parseFloat(adProbabilityMatch[1]);
                        document.getElementById("ad-probability").textContent = `광고성 확률: ${adProbability.toFixed(2)}%`;
                    } else {
                        document.getElementById("ad-probability").textContent = "광고성 확률: 데이터 없음";
                    }
                } else {
                    document.getElementById("ad-probability").textContent = "광고성 확률: 데이터 없음";
                }

                // Highlight # and @ mentions
                // highlightHashtagsAndMentions();
            }
        }

        // 이전 게시물 버튼
        document.getElementById("prev-post").addEventListener("click", () => {
            if (currentPostIndex > 0) {
                currentPostIndex--;
                displayPost();
            } else {
                alert("첫 번째 게시물입니다.");
            }
        });

        // 다음 게시물 버튼
        document.getElementById("next-post").addEventListener("click", () => {
            if (currentPostIndex < postsData.length - 1) {
                currentPostIndex++;
                displayPost();
            } else {
                alert("마지막 게시물입니다.");
            }
        });

        // 팝업 관련 요소
        const modal = document.getElementById("modal");
        const popupButton = document.getElementById("popup-button");
        const closeModalButton = document.getElementById("close-modal");
        const analyzeButton = document.getElementById("analyze-button");
        const resultSection = document.getElementById("result-section");
        const userInput = document.getElementById("user-input");
        const adScore = document.getElementById("ad-score");
        const keywordList = document.getElementById("keyword-list");

        // 광고 분석 팝업 열기
        popupButton.addEventListener("click", () => {
            userInput.value = ""; // 입력 필드 초기화
            resultSection.classList.add("hidden"); // 결과 숨기기
            modal.classList.remove("hidden"); // 팝업 표시
        });

        // 팝업 닫기
        closeModalButton.addEventListener("click", () => {
            modal.classList.add("hidden"); // 팝업 숨기기
        });

        // 광고 분석 실행
        analyzeButton.addEventListener("click", async () => {
            const userInputText = userInput.value.trim();
            if (!userInputText) return alert("분석할 내용을 입력하세요!");
            try {
                const response = await fetch("http://127.0.0.1:8000/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ text: userInputText }),
                });

                if (response.ok) {
                    const result = await response.json();

                    // 광고성 확률 표시
                    adScore.textContent = `광고성 확률: ${result.ad_probability.toFixed(2)}%`;

                    // 중요 키워드 표시
                    if (result.important_keywords && result.important_keywords.length > 0) {
                        keywordList.innerHTML = result.important_keywords.map(
                            keyword => `<li>${keyword.word}</li>`
                        ).join("");
                    } else {
                        keywordList.innerHTML = "<li>키워드 없음</li>";
                    }

                    resultSection.classList.remove("hidden");
                } else {
                    alert("분석 요청 실패");
                }
            } catch (error) {
                console.error(error);
                alert("서버 오류 발생");
            }
        });

        // // # 및 @로 시작하는 단어를 파란색으로 변경하는 함수
        // function highlightHashtagsAndMentions() {
        //     const postTextElement = document.getElementById("post-text");
        //     const originalText = postTextElement.innerHTML;
        //
        //     // 정규식으로 # 또는 @로 시작하는 단어 찾기
        //     const updatedText = originalText.replace(/(#\S+|@\S+)/g, (match) => {
        //         return `<span class="highlight">${match}</span>`;
        //     });
        //
        //     postTextElement.innerHTML = updatedText;
        // }

        // 첫 번째 게시물 표시
        displayPost();
    </script>
</body>
</html>
